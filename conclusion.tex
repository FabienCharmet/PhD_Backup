\section{Conclusion}
\label{sec:thesis_conclusion}
Network virtualization offers new service possibilities, in which a tenant can define his own network to interconnect virtual machines to operate his business. The tenant may request specific resources or define constraints for his virtual network, \eg minimum bandwidth, geographical location of the physical substrate, security requirements for the network traffic \etc
Virtual Network migration is a process used by an infrastructure provider to ensure a certain level of quality of service for the user.
This common maintenance operation may occur due to a physical failure of a network equipment or because the network is under an ongoing attack.

Existing literature presents an extensive security study of Virtual Machines and the migration process, evaluating existing migration solutions and considering different types of attackers. We advocated that the virtualization of the network resource is subject to a similar attack surface because of the nature of the virtualization mechanism. This similarity still stands for the migration process itself, and despite the scarce literature on the topic, consequences on data security violations remain an important matter.

In this thesis we investigated the security of the migration of a virtual network in an SDN environment. 
We sought to answer three questions regarding this matter:

\begin{itemize}
    \item How can the security of the migration be characterized ?
    \item How can the security of the migration be verified ?
    \item Are the model's assumptions realistic, 
\end{itemize}

We focused on a formal approach, providing a model to express security properties, how to monitor them in a real infrastructure, and how to formally verify their validity. 
We covered a broad attack surface, considering the data impacted by the migration as well as the underlying physical infrastructure supporting the virtualization operations and the migration process. 
This approach is based on the hypothesis that it is possible to detect every attack and monitor every network activity in the infrastructure. 
We proposed to alleviate this hypothesis to enable the model to be used in a realistic environment, and we formulated a resource allocation problem to do so.

The first contribution presents a formal model to characterize the security of the migration process. We considered several security properties and described them using a temporal first order logic. Traditional properties like Confidentiality, Integrity and Availability are described and detailed them in the context of an SDN infrastructure.
% , and we presented a novel property to model the colocation ratio between virtual network users: the co-residency. 
% Co-residency is a security metric we recommend should be monitored to restrict the attack surface between two end users.
We implemented our model in LISP, using the theorem prover SNARK.
The proof computed with SNARK can be used to determine which event caused the security violation and when it happened.
% We considered an attacker capable of rendering part of the network infrastructure unavailable and capable of accessing or modifying sensitive information.
% Results show that the attack is detected by the theorem prover and when it occured.

Related work on this topic provides several models of networks and interactions between different actors in a communication. Network virtualization, the virtual network migration process and the related security introduce a gap with previous works that we filled with our model.

The second contribution illustrates two different approaches we have envisioned to solve the resource allocation problem. The first approach consists in modeling the problem using Game Theory, the second uses a Markov Decision Process to determine the optimal set of network nodes to monitor the infrastructure.

% Game Theory considers the interactions between several players, here a defender and an attacker.
% The attacker attacks the migration process under a constraint budget. Similarly, the defender can either use deception or monitoring techniques to protect the infrastructure and the migration.
% The different types of games explored have proven to be inadequate in their formalism or resolution to accurately represent and solve the resource allocation problem.

A Markov Decision Process considers the interactions between an agent and a system, here the defender and its infrastructure. We modeled the evolution of the system by deploying monitoring resources on network nodes, and rewarding choices according to the ongoing attacks.
% giving the possibility to the defender to either deploy or remove monitoring resources from a node at a time throughout the migration. 
Rewards are determined by computing the impact of attacks on the migration and evaluating how many nodes are actively participating in the detection of the current attack.
% We considered a threat model similar to the one presented in Section~\ref{sec:formal_model}, and we implemented attacks with the use of the transitions between states, depending on the likelihood of a node being the target of the next attack. 
Results show that the type of physical topology and the number of attackers are the main criteria impacting the allocation of monitoring resources, while the probability of detecting an attack was only playing a minor part in the process. 
Markov Decision Processes have been used for resource allocation problems in the literature, but their use for security purposes remains limited. Our contribution illustrates the capacities of MDP to simulate the behaviour of an attacker without having to formally integrate him as an extra agent in the model.
% , comparatively to the game we proposed.

The focus of our study was centered around the physical infrastructure and the embedding of virtual network on top of it.
% We have illustrated the exploitation of the migration process using several existing network attacks.
There are two main security aspects that have been left out of this study, namely the interactions between the tenant and the hypervisor, as well as the security of the internal components of the network hypervisor.

Additionally, the focus of the resource allocation problem was set on the defender's point of view, while transferring the impact of the attacker's capacities on transitions and rewards. This aspect may not be suited for other types of attacks that could be more complex, for instance when the attack of one node is multi-staged.

The migration of virtual networks was a challenging research topic from a security perspective, because of the recent advances in networking techniques and the lack of specific formalisms and related solutions. We proposed a model in this thesis that sought to be the first step towards advanced evaluation models. We also focused on the applicability of this model and problem resolution tools to be usable in a real life environment. From this starting point, we envision several research leads that can be explored to complete this work on different aspects.

\textbf{Perspectives for future work\\}

We outline several research perspectives among different topics: 

\textbf{Extending the formal model}
\begin{itemize}
    \item 
    The model we have developed in this thesis describes the traditional security properties considered in a computer system. We proposed a first property specifically related to virtual networks: the co-residency. Exploiting this property can be done by monitoring the number of migrations happening in the infrastructure, and determine which end users' networks are regularly migrated. Co-residency can be defined as a threshold when a user seems to share physical resources with another too often. This has been previously highlighted as a potential sign of a malicious behaviour.The network hypervisor can implement virtual network migration to reduce the co-residency between users, thus limiting the existing attack surface.
% , similarly to the works presented in~\cite{nomad-Moon2015b,malicious-atya2017}.

    \item 
    Live migration of Virtual Machines is a well studied topic, and the characterization of the network behaviour during the migration has been considered from a security point of view.
    The migration process has been characterized by a statistical distribution of the bandwidth usage.
    We suggest do apply a similar method where the quantity of OF rules deployed in the network because of the migration is monitored and statistically modeled. This approach can serve as a basis for the definition of a stealth property related to the network migration process. This definition can be exploited to design a traffic noise generator that would minimize the detectability of the whole process.

% The migration traffic can be combined with noise to make the migration process undetectable. Investigating the behavior of network nodes as well as characterizing the network traffic with a statistical model may serve as a basis for the definition of a stealth property related to the network migration process. 

    \item 
    Regarding the characterization of the security properties, implementing secure-by-design migration primitives becomes the second step toward a secured migration process. These primitives describe how the virtual network configuration is deployed inside the physical infrastructure, and propose specific metrics and probes to be used in the generation of the execution trace. Obvious cryptographic protocols will partly answer the confidentiality aspect but these may not be applicable everywhere and other properties (\eg availability, co-residency) are not fit for this solution. We envision a migration scheduling algorithm as a counter measure to the information collection capacities of the attacker considered in the threat model of this thesis.
    
\end{itemize}
\textbf{Extending the MDP model}
\begin{itemize}
    \item 
    The resource allocation problem was modeled to consider the migration of only one virtual network at a time. While this assumptions holds because the attacker is targeting a single user, it is weakened when several virtual networks are migrated simultaneously. Introducing uncertainty about the potential targets in the algorithm makes it more difficult to determine the optimal monitoring nodes. A solution to this problem is to construct a graph representing the embedding of each virtual network, and to remove tenants from the graph when an attack has not impacted the substrate of his virtual network.

    \item 
    As we have previously highlighted, the attack surface considered in this thesis focused on preventing unlawful manipulation or access to sensitive traffic or network equipments. Some network hypervisors focused on resource isolation, to maintain the fair use between users. A potential way to compromise the migration process is to throttle the it by impacting either the physical network resources available and/or the communication between tenants and the hypervisor to disrupt the hypervisor from the control plane side. We propose to deploy local probes to identify the source of the denial of service. Then, we suggest to deploy local black holes in the infrastructure to drop the malicious traffic as close of the source as possible.

    \item 
    The complexity incurred by the number of states generated to compute the optimal policy of a Markov Decision Process represents a computationally heavy problem for the implementation of our work inside a Cloud infrastructure composed of thousands of network nodes, virtual machines and tenants. We may investigate this aspect by proposing the clustering of the infrastructure into small kernels and apply our MDP resolution on each kernel. Then, we would propose a combining technique that would tie kernels together.

    \item 
    We may consider Partially Observable Markov Decision Processes (POMDP) to extend the impact of network attacks.
    The formalism used in this thesis supposes that the agent is immediately aware of which node has been compromised by the attacker. The use of a POMDP introduces uncertainty in the decision process due to the inability of the agent to accurately determine which node has been compromised on a real-time basis. POMDP would also imply to explore new directions for the definition of the \textit{a priori} deployment.
    
    \item 
    The modeling of the MDP and the different components supposed a uniformity in the detection capacity and behaviour of elements in the infrastructure (\eg attacks have identical execution traces independently from the attack source or the underlying network equipments). We propose to evaluate the behaviour of physical network equipments under realistic attack scenarios and to extract a categorization from the collected data. This can be then leveraged to augment the representation of compromised nodes during the migration.
\end{itemize}
% We improved the design of our verification model for its use in a realistic context by considering its deployment under an imperfect and resource constrained environment. 

% More precisely, we have proposed a formal representation of the security, mapped this model with concrete networking events and generated a formal proof of the verification of the security. 

% Finally, we designed a resource allocation problem to alleviate the hypothesis made for the formal model that network monitoring was perfect and cost free. We studied two formalism to solve this problem, namely Game Theory and Markov Decision Processes.  
% \FC{Leveraging security techniques to determine a better substrate for the migration during an attack }
% \FC{Check reference architecture -> security component ideas}
% \FC{Extending model for multi user topology etc.}
% \FC{Verifying specific predicates}
% \FC{dynam}

To conclude, we have explored the field of virtual networks security from a formal perspective.
We have considered different formalisms to describe, evaluate and verify the security of the migration process. The topic of our research was focused on a specific aspect of network virtualization, but we strongly believe that the methodology used throughout this thesis should be applied to a wider domain.
The communications between network equipments and SDN controllers or SDN-based network hypervisors are of particular interest because they can be abused to exploit the decoupling between control and data plane and allow all sorts of attacks to be launched by an attacker located inside a specific plane.
We also believe that the flexibility in these formalisms should be leveraged to represent an attacker acting in such SDN environment and to propose countermeasures to such attacks.